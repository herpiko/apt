'\" t
.\"     Title: apt_preferences
.\"    Author: APT team
.\" Generator: DocBook XSL Stylesheets v1.75.1 <http://docbook.sf.net/>
.\"      Date: 29 February 2004
.\"    Manual: [FIXME: manual]
.\"    Source: Linux
.\"  Language: English
.\"
.TH "APT_PREFERENCES" "5" "29 February 2004" "Linux" "[FIXME: manual]"
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
apt_preferences \- APT 設定制御ファイル
.SH "説明"
.PP
APT 設定ファイル
/etc/apt/preferences
は、 インストールするパッケージのバージョン選択を制御するのに使用します。
.PP
\fBsources.list\fR(5)
ファイルに複数のディストリビューション (stable
と
testing
など) が指定されていて、 パッケージに対し複数のバージョンがインストールできることがあります。 このとき APT は、利用できるバージョンごとに優先度を割り当てます。 依存関係規則を条件として、\fBapt\-get\fR
は、 最も高い優先度を持つバージョンをインストールするよう選択します。 APT 設定ファイルは、APT がデフォルトで割り当てた、 パッケージのバージョンの優先度を上書きします。 その結果、インストールするものの選択を、ユーザが選択できるようになります。
.PP
\fBsources.list\fR(5)
ファイルに複数の参照が書かれている場合、 パッケージの同じバージョンのインスタンスが複数利用できる可能性があります。 この場合、\fBapt\-get\fR
は
\fBsources.list\fR(5)
ファイルの初めの方に指定されているところからダウンロードします。 APT 設定ファイルは、バージョンの選択にのみ影響し、 インスタンスの選択には影響しません。
.SS "APT のデフォルト優先度の割り当て"
.PP
設定ファイルがなかったり、 設定ファイルに、特定のパッケージを割り当てるエントリがない場合、 そのバージョンの優先度は、 そのバージョンが属しているディストリビューションの優先度となります。 デフォルトで他のディストリビューションより高い優先度を持つ、 特定のディストリビューションを「ターゲットリリース」としておくのは可能です。 ターゲットリリースは、\fBapt\-get\fR
のコマンドラインで設定したり、 APT 設定ファイル
/etc/apt/apt\&.conf
で設定したりできます。 例えば以下のようになります。
.sp
.if n \{\
.RS 4
.\}
.nf
\fBapt\-get install \-t testing \fR\fB\fIsome\-package\fR\fR
.fi
.if n \{\
.RE
.\}
.sp

.sp
.if n \{\
.RS 4
.\}
.nf
APT::Default\-Release "stable";
.fi
.if n \{\
.RE
.\}
.PP
ターゲットリリースが指定されると、APT は以下のアルゴリズムで、 パッケージのバージョンの優先度を設定します。このように割り当てます。
.PP
優先度 100
.RS 4
(あるならば) 既にインストールされているバージョン。
.RE
.PP
優先度 500
.RS 4
インストールされておらず、ターゲットリリースに含まれないバージョン。
.RE
.PP
優先度 990
.RS 4
インストールされておらず、ターゲットリリースに含まれるバージョン。
.RE
.PP
ターゲットリリースが指定されていなければ、 APT は単純にインストールしているパッケージのバージョンには 100 を、 インストールしていないパッケージのバージョンには 500 を割り当てます。
.PP
APT は、インストールするパッケージのバージョンを決定するために、 以下のルールを上から順番に適用します。
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
有効なバージョンの優先度が 1000 を越えない場合、 決してダウングレードしません。 (「ダウングレード」は、現在のパッケージのバージョンよりも、 小さいバージョンのものをインストールします。 APT のデフォルト優先度が 1000 を越えないことに注意してください。 そのような優先度は設定ファイルでのみ設定できます。 また、パッケージのダウングレードは危険であることにも注意してください)
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
最も高い優先度のバージョンをインストールします。
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
同じ優先度のバージョンが複数存在する場合、 最も新しいもの (最もバージョン番号が高いもの) をインストールします。
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
優先度・バージョン番号が同じものが複数存在し、 そのパッケージのメタデータが異なるか
\-\-reinstall
オプションが与えられている場合、 インストールされていないものをインストールします。
.RE
.sp
.RE
.PP
よくある状況として、 あるインストールされているパッケージのバージョン (優先度 100) が、
\fBsources.list\fR(5)
ファイルのリストから得られるバージョン (優先度 500 か 990) よりも新しくないということがあります。この場合、
\fBapt\-get install \fR\fB\fIsome\-package\fR\fR
や
\fBapt\-get upgrade\fR
を実行するとパッケージが更新されます。
.PP
まれに、インストールされているパッケージのバージョンが、
\fI他の有効なバージョンよりも\fR新しい場合があります。 この時
\fBapt\-get install \fR\fB\fIsome\-package\fR\fR
や
\fBapt\-get upgrade\fR
を実行しても、 ダウングレードしません。
.PP
時々、インストールしているパッケージのバージョンが、 ターゲットリリースに属するバージョンよりも新しく、 他のディストリビューションよりも古い場合があります。 そのようなパッケージに対して
\fBapt\-get install \fR\fB\fIsome\-package\fR\fR
や
\fBapt\-get upgrade\fR
を実行すると、 パッケージは更新されます。 この場合、インストールされているバージョンよりも、 少なくとも\fIひとつ\fRは、 高い優先度を持つ有効なパッケージがあるからです。
.SS "APT 設定の効果"
.PP
APT 設定ファイルを使うと、 システム管理者が優先度を割り当てられるようになります。 ファイルは、空白行で区切られた、複数行からなるレコードで構成されています。 レコードは特定形式か、汎用形式のどちらかの形式をとります。
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
特定形式は、優先度 ("Pin\-Priority") を、 指定したパッケージの指定したバージョン (範囲) について割り当てます。 例えば以下のレコードは、 "5\&.8" で始まる
perl
パッケージを、 高い優先度に設定します。
.sp
.if n \{\
.RS 4
.\}
.nf
Package: perl
Pin: version 5\&.8*
Pin\-Priority: 1001
.fi
.if n \{\
.RE
.\}
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
汎用形式は、与えられたディストリビューションにある、 すべてのパッケージ (Release
ファイルに列挙したパッケージ) の優先度や、FQDNで指定した、 特定のインターネットサイトから取得するパッケージの優先度を割り当てます。
.sp
APT 設定ファイルに書かれている汎用形式のエントリは、 パッケージのグループについてのみ適用されます。 例えば以下のレコードは、ローカルサイトにある全パッケージについて、 高い優先度を割り当てます。
.sp
.if n \{\
.RS 4
.\}
.nf
Package: *
Pin: origin ""
Pin\-Priority: 999
.fi
.if n \{\
.RE
.\}
.sp
注: ここで使用しているキーワードは "origin" です。
Release
ファイルに指定されたような、 ディストリビューションの Origin と混同しないようにしてください。
Release
ファイルにある "Origin:" タグは、 インターネットアドレスではなく、 "Debian" や "Ximian" といった作者やベンダ名です。
.sp
以下のレコードは、アーカイブ名が "unstable" となっているディストリビューションに属するパッケージを、 すべて低い優先度に割り当てます。
.sp
.if n \{\
.RS 4
.\}
.nf
Package: *
Pin: release a=unstable
Pin\-Priority: 50
.fi
.if n \{\
.RE
.\}
.sp
以下のレコードは、アーカイブ名が "stable" で、 リリースバージョン番号が "3\&.0" となっているリリースに属するパッケージを、 すべて高い優先度に割り当てます。
.sp
.if n \{\
.RS 4
.\}
.nf
Package: *
Pin: release a=stable, v=3\&.0
Pin\-Priority: 500
.fi
.if n \{\
.RE
.\}
.RE
.sp
.RE
.SS "APT が優先度に割り込む方法"
.PP

APT 設定ファイルで割り当てた優先度 (P) は、正負の整数でなくてはなりません。 これは (おおざっぱにいうと) 以下のように解釈されます。
.PP
P > 1000
.RS 4
パッケージがダウングレードしても、このバージョンのパッケージをインストールします。
.RE
.PP
990 < P <=1000
.RS 4
インストールされているバージョンの方が新しいことを除き、 ターゲットリリースに含まれなくても、 このバージョンのパッケージをインストールします。
.RE
.PP
500 < P <=990
.RS 4
ターゲットリリースに属するバージョンがあったり、 インストールされているバージョンの方が新しいのでなければ、 このバージョンのパッケージをインストールします。
.RE
.PP
100 < P <=500
.RS 4
他のディストリビューションに属するバージョンがあったり、 インストールされているバージョンの方が新しいのでなければ、 このバージョンのパッケージをインストールします。
.RE
.PP
0 < P <=100
.RS 4
このパッケージがインストールされていない場合、 このバージョンのパッケージをインストールします。
.RE
.PP
P < 0
.RS 4
このバージョンがインストールされないようにします。
.RE
.PP
特定形式のレコードが利用可能パッケージバージョンに一致した場合、 最初のレコードが、パッケージバージョンの優先度を決定します。 失敗して、汎用形式のレコードが利用可能パッケージバージョンに一致した場合、 最初のレコードが、パッケージバージョンの優先度を決定します。
.PP
例えば、APT 設定ファイルの上の方に、 以下のレコードが書かれていると仮定してください。
.sp
.if n \{\
.RS 4
.\}
.nf
Package: perl
Pin: version 5\&.8*
Pin\-Priority: 1001

Package: *
Pin: origin ""
Pin\-Priority: 999

Package: *
Pin: release unstable
Pin\-Priority: 50
.fi
.if n \{\
.RE
.\}
.PP
すると、
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
バージョン番号が "5\&.8" で始まっていれば、
perl
の最新の利用可能パッケージがインストールされます。 バージョン 5\&.8* が利用可能で、バージョン 5\&.9* がインストールされている場合、
perl
はダウングレードされます。
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
ローカルシステムで有効な、
perl
以外のどんなパッケージでも、 他のバージョンより (たとえターゲットリリースに属していても) 優先度が高くなります。
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
ローカルシステムにはなくても
\fBsources.list\fR(5)
に列挙されたサイトにあるバージョンで、
unstable
ディストリビューションに属しているパッケージは、 インストールするよう選択され、 既にインストールされているバージョンがない場合にのみインストールされます。
.RE
.sp
.RE
.SS "パッケージのバージョンとディストリビューションプロパティの決定"
.PP
\fBsources.list\fR(5)
ファイルに列挙した場所では、 その場所で利用できるパッケージを記述した、
Packages
ファイルや
Release
ファイルを提供します。
.PP
Packages
ファイルは通常
\&.\&.\&./dists/\fIdist\-name\fR/\fIcomponent\fR/\fIarch\fR
ディレクトリにあります。 例えば、\&.\&.\&./dists/stable/main/binary\-i386/Packages
です。 これは、ディレクトリにある利用可能パッケージごとに、 複数行のレコードからできています。 APT 優先度の設定は、レコードごとに以下の 2 行だけです。
.PP
Package: 行
.RS 4
パッケージ名を与えます。
.RE
.PP
Version: 行
.RS 4
その名前のパッケージのバージョン番号を与えます。
.RE
.PP
Release
ファイルは、通常
\&.\&.\&./dists/\fIdist\-name\fR
にあります。例えば、
\&.\&.\&./dists/stable/Release,
\&.\&.\&./dists/woody/Release
です。 これは、このディレクトリ以下にある\fI全\fRパッケージに適用する、 複数行のレコード 1 つから成っています。
Packages
と違い
Release
ファイルは、 ほとんどの行が APT 優先度の設定に関連します。
.PP
Archive: 行
.RS 4
このディレクトリツリーに属する全パッケージのアーカイブ名。 例えば、 "Archive: stable" という行は、Release
ファイルの親ディレクトリツリー以下にある全パッケージが、
stable
アーカイブだと指定します。 APT 設定ファイルでこの値を指定するには、以下の行が必要になります。
.sp
.if n \{\
.RS 4
.\}
.nf
Pin: release a=stable
.fi
.if n \{\
.RE
.\}
.RE
.PP
Version: 行
.RS 4
リリースバージョン名。 例えば、このツリーのパッケージが、 GNU/Linux リリースバージョン 3\&.0 に属するとします。 通常
testing
ディストリビューションや
unstable
ディストリビューションには、 まだリリースされていないので、バージョン番号が付きません。 APT 設定ファイルでこれを指定するには、以下の行のいずれかが必要になります。
.sp
.if n \{\
.RS 4
.\}
.nf
Pin: release v=3\&.0
Pin: release a=stable, v=3\&.0
Pin: release 3\&.0
.fi
.if n \{\
.RE
.\}
.RE
.PP
Component: 行
.RS 4
Release
ファイルの、 ディレクトリツリーにあるパッケージのライセンスコンポーネント名。 例えば、"Component: main" という行は、このディレクトリ以下の全ファイルが、
main
コンポーネント (Debian フリーソフトウェアガイドラインの元でライセンスされている) であることを表します。 APT 設定ファイルでこのコンポーネントを指定するには、以下の行が必要になります。
.sp
.if n \{\
.RS 4
.\}
.nf
Pin: release c=main
.fi
.if n \{\
.RE
.\}
.RE
.PP
Origin: 行
.RS 4
Release
ファイルのディレクトリツリーにあるパッケージの提供者名。 ほとんど共通で、Debian
です。 APT 設定ファイルでこの提供者を指定するには、以下の行が必要になります。
.sp
.if n \{\
.RS 4
.\}
.nf
Pin: release o=Debian
.fi
.if n \{\
.RE
.\}
.RE
.PP
Label: 行
.RS 4
Release
ファイルのディレクトリツリーにあるパッケージのラベル名。 ほとんど共通で
Debian
です。 APT 設定ファイルでこのラベルを指定するには、以下の行が必要になります。
.sp
.if n \{\
.RS 4
.\}
.nf
Pin: release l=Debian
.fi
.if n \{\
.RE
.\}
.RE
.PP
\fBsources.list\fR(5)
ファイルに列挙された場所から取得した
Packages
ファイルや
Release
ファイルはすべて、
/var/lib/apt/lists
ディレクトリや、
apt\&.conf
ファイルの
Dir::State::Lists
変数で指定した場所に取得されます。例えば、
debian\&.lcs\&.mit\&.edu_debian_dists_unstable_contrib_binary\-i386_Release
ファイルは、
debian\&.lcs\&.mit\&.edu
から取得した、
unstable
ディストリビューションで、
contrib
コンポーネントな、
binary\-i386
アーキテクチャ用の
Release
ファイルを含んでいます。
.SS "APT 設定レコードのオプション行"
.PP
APT 設定ファイルのレコードごとに、 任意で
Explanation:
で始まる行を持てます。 これは、コメント用の場所を確保します。
.PP
APT 設定レコードの
Pin\-Priority:
行は任意です。 省略すると、Pin\-Priority: release \&.\&.\&.
で始まる行で指示した最後の値 (少なくとも1つ) を優先度に割り当てます。
.SH "サンプル"
.SS "安定版を追跡"
.PP
以下の APT 設定ファイルは、stable
ディストリビューションに属する全てのパッケージのバージョンに、 デフォルト (500) より高い優先度を割り当て、 他の
Debian
ディストリビューションのパッケージのバージョンには、 低くてインストールできないような優先度を割り当てます。
.sp
.if n \{\
.RS 4
.\}
.nf
Explanation: Uninstall or do not install any Debian\-originated
Explanation: package versions other than those in the stable distro
Package: *
Pin: release a=stable
Pin\-Priority: 900

Package: *
Pin: release o=Debian
Pin\-Priority: \-10
.fi
.if n \{\
.RE
.\}
.PP
適切な
\fBsources.list\fR(5)
ファイルと上記の設定ファイルにより、 以下のコマンドで最新の
stable
バージョンにアップグレードできます。
.sp
.if n \{\
.RS 4
.\}
.nf
apt\-get install \fIpackage\-name\fR
apt\-get upgrade
apt\-get dist\-upgrade
.fi
.if n \{\
.RE
.\}
.PP
以下のコマンドで、指定したパッケージを
testing
ディストリビューションの最新バージョンにアップグレードします。 このパッケージは、再度このコマンドを発行しないとアップグレードされません。
.sp
.if n \{\
.RS 4
.\}
.nf
apt\-get install \fIpackage\fR/testing
.fi
.if n \{\
.RE
.\}
.sp
.SS "テスト版や不安定版を追跡"
.PP
以下の APT 設定ファイルは、testing
ディストリビューションのパッケージのバージョンに高い優先度を割り当て、
unstable
ディストリビューションのパッケージのバージョンには低い優先度を割り当てます。 また他の
Debian
ディストリビューションのパッケージのバージョンには、 低くてインストールできないような優先度を割り当てます。
.sp
.if n \{\
.RS 4
.\}
.nf
Package: *
Pin: release a=testing
Pin\-Priority: 900

Package: *
Pin: release a=unstable
Pin\-Priority: 800

Package: *
Pin: release o=Debian
Pin\-Priority: \-10
.fi
.if n \{\
.RE
.\}
.PP
適切な
\fBsources.list\fR(5)
ファイルと上記の設定ファイルにより、 以下のコマンドで最新の
testing
バージョンにアップグレードできます。
.sp
.if n \{\
.RS 4
.\}
.nf
apt\-get install \fIpackage\-name\fR
apt\-get upgrade
apt\-get dist\-upgrade
.fi
.if n \{\
.RE
.\}
.PP
以下のコマンドで、指定したパッケージを
unstable
ディストリビューションの最新バージョンにアップグレードします。 それ以降、\fBapt\-get upgrade\fR
は
testing
バージョンのパッケージが更新されていれば
testing
の最新版に、
unstable
バージョンのパッケージが更新されていれば
unstableの最新版にアップグレードします。
.sp
.if n \{\
.RS 4
.\}
.nf
apt\-get install \fIpackage\fR/unstable
.fi
.if n \{\
.RE
.\}
.sp
.SH "関連項目"
.PP
\fBapt-get\fR(8)
\fBapt-cache\fR(8)
\fBapt.conf\fR(5)
\fBsources.list\fR(5)
.SH "バグ"
.PP
\m[blue]\fBAPT バグページ\fR\m[]\&\s-2\u[1]\d\s+2を ご覧ください。 APT のバグを報告する場合は、
/usr/share/doc/debian/bug\-reporting\&.txt
や
\fBreportbug\fR(1)
コマンドをご覧ください。
.SH "訳者"
.PP
倉澤 望
nabetaro@debian\&.or\&.jp
(2003\-2006), Debian JP Documentation ML
debian\-doc@debian\&.or\&.jp
.SH "AUTHOR"
.PP
\fBAPT team\fR
.RS 4
Author.
.RE
.SH "NOTES"
.IP " 1." 4
APT バグページ
.RS 4
\%http://bugs.debian.org/src:apt
.RE
